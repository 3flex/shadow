(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{368:function(t,a,e){"use strict";e.r(a);var n=e(42),s=Object(n.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"relocating-packages"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#relocating-packages"}},[t._v("#")]),t._v(" Relocating Packages")]),t._v(" "),e("p",[t._v("Shadow is capable of scanning a project's classes and relocating specific dependencies to a new location.\nThis is often required when one of the dependencies is susceptible to breaking changes in versions or\nto classpath pollution in a downstream project.")]),t._v(" "),e("blockquote",[e("p",[t._v("Google's Guava and the ASM library are typical cases where package relocation can come in handy.")])]),t._v(" "),e("p",[t._v("Shadow uses the ASM library to modify class byte code to replace the package name and any import\nstatements for a class.\nAny non-class files that are stored within a package structure are also relocated to the new location.")]),t._v(" "),e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Relocating a Package")]),t._v("\nshadowJar "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   relocate "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'junit.framework'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'shadow.junit'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("The code snippet will rewrite the location for any class in the "),e("code",[t._v("junit.framework")]),t._v(" to be "),e("code",[t._v("shadow.junit")]),t._v(".\nFor example, the class "),e("code",[t._v("junit.textui.TestRunner")]),t._v(" becomes "),e("code",[t._v("shadow.junit.TestRunner")]),t._v(".\nIn the resulting JAR, the class file is relocated from "),e("code",[t._v("junit/textui/TestRunner.class")]),t._v(" to\n"),e("code",[t._v("shadow/junit/TestRunner.class")]),t._v(".")]),t._v(" "),e("blockquote",[e("p",[t._v("Relocation operates at a package level.\nIt is not necessary to specify any patterns for matching, it will operate simply on the prefix\nprovided.")])]),t._v(" "),e("blockquote",[e("p",[t._v("Relocation will be applied globally to all instances of the matched prefix.\nThat is, it does "),e("strong",[t._v("not")]),t._v(" scope to "),e("em",[t._v("only")]),t._v(" the dependencies being shadowed.\nBe specific as possible when configuring relocation as to avoid unintended relocations.")])]),t._v(" "),e("h2",{attrs:{id:"filtering-relocation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#filtering-relocation"}},[t._v("#")]),t._v(" Filtering Relocation")]),t._v(" "),e("p",[t._v("Specific classes or files can be "),e("code",[t._v("included")]),t._v("/"),e("code",[t._v("excluded")]),t._v(" from the relocation operation if necessary. Use\n"),e("a",{attrs:{href:"https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/util/AntPathMatcher.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ant Path Matcher"),e("OutboundLink")],1),t._v("\nsyntax to specify matching path for your files and directories.")]),t._v(" "),e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Configuring Filtering for Relocation")]),t._v("\nshadowJar "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("relocate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'junit.textui'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       exclude "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'junit.textui.TestRunner'")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("relocate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'junit.framework'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       include "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'junit.framework.Test*'")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("For a more advanced path matching you might want to use "),e("a",{attrs:{href:"https://regexr.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Regular Expressions"),e("OutboundLink")],1),t._v(" instead. Wrap the expresion in "),e("code",[t._v("%regex[]")]),t._v(" before\npassing it to "),e("code",[t._v("include")]),t._v("/"),e("code",[t._v("exclude")]),t._v(".")]),t._v(" "),e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Configuring Filtering for Relocation with Regex")]),t._v("\nshadowJar "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("relocate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.foo'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       include "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%regex[org/foo/.*Factory[0-9].*]'")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"automatically-relocating-dependencies"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#automatically-relocating-dependencies"}},[t._v("#")]),t._v(" Automatically Relocating Dependencies")]),t._v(" "),e("p",[t._v("Shadow is shipped with a task that can be used to automatically configure all packages from all dependencies to be relocated.\nThis feature was formally shipped into a 2nd plugin ("),e("code",[t._v("com.github.johnrengelman.plugin-shadow")]),t._v(") but has been\nremoved for clarity reasons in version 4.0.0.")]),t._v(" "),e("p",[t._v("To configure automatic dependency relocation, declare a task of type "),e("code",[t._v("ConfigureShadowRelocation")]),t._v(" and configure the\n"),e("code",[t._v("target")]),t._v(" parameter to be the "),e("code",[t._v("ShadowJar")]),t._v(" task you wish to auto configure. You will also need to declare a task\ndependency so the tasks execute in the correct order.")]),t._v(" "),e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Configure Auto Relocation")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("github"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jengelman"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gradle"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shadow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tasks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ConfigureShadowRelocation\n\ntask "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("relocateShadowJar")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ConfigureShadowRelocation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    target "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tasks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shadowJar\n    prefix "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"myapp"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// Default value is "shadow"')]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ntasks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shadowJar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dependsOn tasks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("relocateShadowJar\n")])])]),e("blockquote",[e("p",[t._v("Configuring package auto relocation can add significant time to the shadow process as it will process all dependencies\nin the configurations declared to be shadowed. By default, this is the "),e("code",[t._v("runtime")]),t._v(" or "),e("code",[t._v("runtimeClasspath")]),t._v(" configurations.\nBe mindful that some Gradle plugins will automatically add dependencies to your class path. You may need to remove these\ndependencies if you do not intend to shadow them into your library.  The "),e("code",[t._v("java-gradle-plugin")]),t._v(" would normally cause such\nproblems if it were not for the special handling that Shadow provides as described in\n"),e("RouterLink",{attrs:{to:"/plugins/#special-handling-of-the-java-gradle-plugin-gevelopmeny-plugin"}},[t._v("Special Handling of the Java Gradle Plugin Development Plugin")]),t._v(".")],1)])])}),[],!1,null,null,null);a.default=s.exports}}]);