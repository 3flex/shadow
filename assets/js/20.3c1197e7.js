(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{171:function(a,e,t){"use strict";t.r(e);var n=t(0),s=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"using-shadow-to-package-gradle-plugins"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#using-shadow-to-package-gradle-plugins","aria-hidden":"true"}},[a._v("#")]),a._v(" Using Shadow to Package Gradle Plugins")]),a._v(" "),t("p",[a._v("In some scenarios, writing a Gradle plugin can be problematic because your plugin may depend on a version that\nconflicts with the same dependency provided by the Gradle runtime. If this is the case, then you can utilize Shadow\nto relocate your dependencies to a different package name to avoid the collision.")]),a._v(" "),t("p",[a._v("Configuring the relocation has always been possible, but the build author is required to know all the package names\nbefore hand. Shadow v2.0 corrects this by introducing a new task type "),t("code",[a._v("ConfigureShadowRelocation")]),a._v(".\nTasks of this type are configured to target an instance of a "),t("code",[a._v("ShadowJar")]),a._v(" task and run immediately before it.")]),a._v(" "),t("p",[a._v("The "),t("code",[a._v("ConfigureShadowRelocation")]),a._v(" task, scans the dependencies from the configurations specified on the associated\n"),t("code",[a._v("ShadowJar")]),a._v(" task and collects the package names contained within them. It then configures relocation for these\npackages using the specified "),t("code",[a._v("prefix")]),a._v(" on the associated "),t("code",[a._v("ShadowJar")]),a._v(" task.")]),a._v(" "),t("p",[a._v("While this is useful for developing Gradle plugins, nothing about the "),t("code",[a._v("ConfigureShadowRelocation")]),a._v(" task is tied to\nGradle projects. It can be used for standard Java or Groovy projects.")]),a._v(" "),t("p",[a._v("A simple Gradle plugin can use this feature by applying the "),t("code",[a._v("shadow")]),a._v(" plugin and configuring the relocation task\nto execute before the "),t("code",[a._v("shadowJar")]),a._v(" tasks:")]),a._v(" "),t("div",{staticClass:"language-groovy no-plugins extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[t("span",{attrs:{class:"token keyword"}},[a._v("import")]),a._v(" com"),t("span",{attrs:{class:"token operator"}},[a._v(".")]),a._v("github"),t("span",{attrs:{class:"token operator"}},[a._v(".")]),a._v("jengelman"),t("span",{attrs:{class:"token operator"}},[a._v(".")]),a._v("gradle"),t("span",{attrs:{class:"token operator"}},[a._v(".")]),a._v("plugins"),t("span",{attrs:{class:"token operator"}},[a._v(".")]),a._v("shadow"),t("span",{attrs:{class:"token operator"}},[a._v(".")]),a._v("tasks"),t("span",{attrs:{class:"token operator"}},[a._v(".")]),a._v("ConfigureShadowRelocation\n\nplugins "),t("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  id "),t("span",{attrs:{class:"token string"}},[a._v("'com.github.johnrengelman.shadow'")]),a._v(" version "),t("span",{attrs:{class:"token string"}},[a._v("'5.1.0'")]),a._v("\n  id "),t("span",{attrs:{class:"token string"}},[a._v("'java'")]),a._v("\n"),t("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\ndependencies "),t("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    shadow "),t("span",{attrs:{class:"token function"}},[a._v("localGroovy")]),t("span",{attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    shadow "),t("span",{attrs:{class:"token function"}},[a._v("gradleApi")]),t("span",{attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n    compile "),t("span",{attrs:{class:"token string"}},[a._v("'org.jdom:jdom2:2.0.6'")]),a._v("\n    compile "),t("span",{attrs:{class:"token string"}},[a._v("'org.ow2.asm:asm:6.0'")]),a._v("\n    compile "),t("span",{attrs:{class:"token string"}},[a._v("'org.ow2.asm:asm-commons:6.0'")]),a._v("\n    compile "),t("span",{attrs:{class:"token string"}},[a._v("'commons-io:commons-io:2.4'")]),a._v("\n    compile "),t("span",{attrs:{class:"token string"}},[a._v("'org.apache.ant:ant:1.9.4'")]),a._v("\n    compile "),t("span",{attrs:{class:"token string"}},[a._v("'org.codehaus.plexus:plexus-utils:2.0.6'")]),a._v("\n"),t("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\ntask "),t("span",{attrs:{class:"token function"}},[a._v("relocateShadowJar")]),t("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("type"),t("span",{attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ConfigureShadowRelocation"),t("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    target "),t("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(" tasks"),t("span",{attrs:{class:"token operator"}},[a._v(".")]),a._v("shadowJar\n"),t("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\ntasks"),t("span",{attrs:{class:"token operator"}},[a._v(".")]),a._v("shadowJar"),t("span",{attrs:{class:"token operator"}},[a._v(".")]),a._v("dependsOn tasks"),t("span",{attrs:{class:"token operator"}},[a._v(".")]),a._v("relocateShadowJar\n")])])]),t("p",[a._v("Note that the "),t("code",[a._v("localGroovy()")]),a._v(" and "),t("code",[a._v("gradleApi()")]),a._v(" dependencies are added to the "),t("code",[a._v("shadow")]),a._v(" configuration instead of the\nnormal "),t("code",[a._v("compile")]),a._v(" configuration. These 2 dependencies are provided by Gradle to compile your project but are ultimately\nprovided by the Gradle runtime when executing the plugin. Thus, it is "),t("strong",[a._v("not")]),a._v(" advisable to bundle these dependencies\nwith your plugin.")]),a._v(" "),t("h2",{attrs:{id:"special-handling-of-the-java-gradle-plugin-development-plugin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#special-handling-of-the-java-gradle-plugin-development-plugin","aria-hidden":"true"}},[a._v("#")]),a._v(" Special Handling of the Java Gradle Plugin Development Plugin")]),a._v(" "),t("p",[a._v("The Java Gradle Plugin Development plugin, "),t("code",[a._v("java-gradle-plugin")]),a._v(", automatically adds the full Gradle API to the "),t("code",[a._v("compile")]),a._v("\nconfiguration; thus overriding a possible assignment of "),t("code",[a._v("gradleApi()")]),a._v(" to the "),t("code",[a._v("shadow")]),a._v(" configuration.  Since it is never\na good idea to include the Gradle API when creating a Gradle plugin, the dependency is removed so that it is not\nincluded in the resultant shadow jar.  Virtually:")]),a._v(" "),t("pre",[t("code",[a._v("// needed to prevent inclusion of gradle-api into shadow JAR\nconfigurations.compile.dependencies.remove dependencies.gradleApi()\n")])])])}],!1,null,null,null);s.options.__file="README.md";e.default=s.exports}}]);