buildscript {
    repositories {
        maven {
            url 'http://repo.jfrog.org/artifactory/gradle-plugins'
        }
    }
    
    dependencies {
        classpath 'org.jfrog.buildinfo:build-info-extractor-gradle:2.0.9'
    }
}

repositories {
    mavenCentral()
}

apply plugin: 'groovy'
apply plugin: 'maven'
apply plugin: 'artifactory'
apply plugin: 'idea'

group = 'org.gradle.plugins'
version = "${currentVersion}"

dependencies {
    groovy 'org.codehaus.groovy:groovy-all:1.8.6'
    compile gradleApi()
    
    testCompile "org.spockframework:spock-core:0.6-groovy-1.8"
}

artifactoryPublish {
    dependsOn jar
}

artifactory {
    contextUrl = "${project.artifactory_contextUrl}"

    def currentRepoKey = isSnapshot() ? 'libs-snapshot-local' : 'libs-release-local'
    publish {
        repository {
            username = "${artifactory_username}"
            password = "${artifactory_password}"
            repoKey = "${currentRepoKey}"
            maven = true
        }
    }
    resolve {
        repository {
            repoKey = "${currentRepoKey}"
            maven = true
        }
    }
}

boolean isSnapshot() {
    currentVersion.endsWith('SNAPSHOT')
}
