<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Relocating Packages</title>
    <meta name="generator" content="VuePress 1.6.0">
    
    <meta name="description" content="">
    <link rel="preload" href="/shadow/assets/css/0.styles.ede77536.css" as="style"><link rel="preload" href="/shadow/assets/js/app.039bfd27.js" as="script"><link rel="preload" href="/shadow/assets/js/2.09255d06.js" as="script"><link rel="preload" href="/shadow/assets/js/17.36c6b606.js" as="script"><link rel="prefetch" href="/shadow/assets/js/10.40605722.js"><link rel="prefetch" href="/shadow/assets/js/11.0e6c120c.js"><link rel="prefetch" href="/shadow/assets/js/12.24e6fae3.js"><link rel="prefetch" href="/shadow/assets/js/13.bd5f3719.js"><link rel="prefetch" href="/shadow/assets/js/14.cc1a15f1.js"><link rel="prefetch" href="/shadow/assets/js/15.07d3e3a9.js"><link rel="prefetch" href="/shadow/assets/js/16.611c78a5.js"><link rel="prefetch" href="/shadow/assets/js/18.5c2bdb5d.js"><link rel="prefetch" href="/shadow/assets/js/19.274dce72.js"><link rel="prefetch" href="/shadow/assets/js/20.f05e2715.js"><link rel="prefetch" href="/shadow/assets/js/21.bd64759a.js"><link rel="prefetch" href="/shadow/assets/js/22.5aa0ed3a.js"><link rel="prefetch" href="/shadow/assets/js/23.62d27add.js"><link rel="prefetch" href="/shadow/assets/js/24.48738a84.js"><link rel="prefetch" href="/shadow/assets/js/3.0dfc1bcd.js"><link rel="prefetch" href="/shadow/assets/js/4.4deef9ed.js"><link rel="prefetch" href="/shadow/assets/js/5.771c4330.js"><link rel="prefetch" href="/shadow/assets/js/6.e416f727.js"><link rel="prefetch" href="/shadow/assets/js/7.1eb472b6.js"><link rel="prefetch" href="/shadow/assets/js/8.27572bcc.js"><link rel="prefetch" href="/shadow/assets/js/9.86ab16f3.js">
    <link rel="stylesheet" href="/shadow/assets/css/0.styles.ede77536.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/shadow/" class="home-link router-link-active"><img src="/shadow/logo+type.svg" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/shadow/introduction/" class="nav-link">
  User Guide
</a></div> <a href="https://github.com/johnrengelman/shadow" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/shadow/introduction/" class="nav-link">
  User Guide
</a></div> <a href="https://github.com/johnrengelman/shadow" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/shadow/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/shadow/introduction/" class="sidebar-link">Introduction</a></li><li><a href="/shadow/getting-started/" class="sidebar-link">Getting Started</a></li><li><a href="/shadow/configuration/" aria-current="page" class="sidebar-link">Configuring Shadow</a></li><li><a href="/shadow/configuration/filtering/" class="sidebar-link">Filtering Shadow Jar Contents</a></li><li><a href="/shadow/configuration/dependencies/" class="sidebar-link">Configuring Shadowed Dependencies</a></li><li><a href="/shadow/configuration/merging/" class="sidebar-link">Controlling JAR Content Merging</a></li><li><a href="/shadow/configuration/relocation/" aria-current="page" class="active sidebar-link">Relocating Packages</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/shadow/configuration/relocation/#filtering-relocation" class="sidebar-link">Filtering Relocation</a></li><li class="sidebar-sub-header"><a href="/shadow/configuration/relocation/#automatically-relocating-dependencies" class="sidebar-link">Automatically Relocating Dependencies</a></li></ul></li><li><a href="/shadow/configuration/minimizing/" class="sidebar-link">Minimizing</a></li><li><a href="/shadow/configuration/reproducible-builds/" class="sidebar-link">Reproducible Builds</a></li><li><a href="/shadow/custom-tasks/" class="sidebar-link">Creating a Custom ShadowJar Task</a></li><li><a href="/shadow/application-plugin/" class="sidebar-link">Integrating with Application Plugin</a></li><li><a href="/shadow/publishing/" class="sidebar-link">Publishing Shadow JARs</a></li><li><a href="/shadow/multi-project/" class="sidebar-link">Using Shadow in Multi-Project Builds</a></li><li><a href="/shadow/plugins/" class="sidebar-link">Using Shadow to Package Gradle Plugins</a></li><li><a href="/shadow/changes/" class="sidebar-link">Change Log</a></li><li><a href="/shadow/about/" class="sidebar-link">About This Project</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="relocating-packages"><a href="#relocating-packages" class="header-anchor">#</a> Relocating Packages</h1> <p>Shadow is capable of scanning a project's classes and relocating specific dependencies to a new location.
This is often required when one of the dependencies is susceptible to breaking changes in versions or
to classpath pollution in a downstream project.</p> <blockquote><p>Google's Guava and the ASM library are typical cases where package relocation can come in handy.</p></blockquote> <p>Shadow uses the ASM library to modify class byte code to replace the package name and any import
statements for a class.
Any non-class files that are stored within a package structure are also relocated to the new location.</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token comment">// Relocating a Package</span>
shadowJar <span class="token punctuation">{</span>
   relocate <span class="token string">'junit.framework'</span><span class="token punctuation">,</span> <span class="token string">'shadow.junit'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The code snippet will rewrite the location for any class in the <code>junit.framework</code> to be <code>shadow.junit</code>.
For example, the class <code>junit.textui.TestRunner</code> becomes <code>shadow.junit.TestRunner</code>.
In the resulting JAR, the class file is relocated from <code>junit/textui/TestRunner.class</code> to
<code>shadow/junit/TestRunner.class</code>.</p> <blockquote><p>Relocation operates at a package level.
It is not necessary to specify any patterns for matching, it will operate simply on the prefix
provided.</p></blockquote> <blockquote><p>Relocation will be applied globally to all instances of the matched prefix.
That is, it does <strong>not</strong> scope to <em>only</em> the dependencies being shadowed.
Be specific as possible when configuring relocation as to avoid unintended relocations.</p></blockquote> <h2 id="filtering-relocation"><a href="#filtering-relocation" class="header-anchor">#</a> Filtering Relocation</h2> <p>Specific classes or files can be <code>included</code>/<code>excluded</code> from the relocation operation if necessary. Use
<a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/util/AntPathMatcher.html" target="_blank" rel="noopener noreferrer">Ant Path Matcher<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
syntax to specify matching path for your files and directories.</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token comment">// Configuring Filtering for Relocation</span>
shadowJar <span class="token punctuation">{</span>
   <span class="token function">relocate</span><span class="token punctuation">(</span><span class="token string">'junit.textui'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       exclude <span class="token string">'junit.textui.TestRunner'</span>
   <span class="token punctuation">}</span>
   <span class="token function">relocate</span><span class="token punctuation">(</span><span class="token string">'junit.framework'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       include <span class="token string">'junit.framework.Test*'</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For a more advanced path matching you might want to use <a href="https://regexr.com/" target="_blank" rel="noopener noreferrer">Regular Expressions<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> instead. Wrap the expresion in <code>%regex[]</code> before
passing it to <code>include</code>/<code>exclude</code>.</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token comment">// Configuring Filtering for Relocation with Regex</span>
shadowJar <span class="token punctuation">{</span>
   <span class="token function">relocate</span><span class="token punctuation">(</span><span class="token string">'org.foo'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       include <span class="token string">'%regex[org/foo/.*Factory[0-9].*]'</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="automatically-relocating-dependencies"><a href="#automatically-relocating-dependencies" class="header-anchor">#</a> Automatically Relocating Dependencies</h2> <p>Shadow is shipped with a task that can be used to automatically configure all packages from all dependencies to be relocated.
This feature was formally shipped into a 2nd plugin (<code>com.github.johnrengelman.plugin-shadow</code>) but has been
removed for clarity reasons in version 4.0.0.</p> <p>To configure automatic dependency relocation, declare a task of type <code>ConfigureShadowRelocation</code> and configure the
<code>target</code> parameter to be the <code>ShadowJar</code> task you wish to auto configure. You will also need to declare a task
dependency so the tasks execute in the correct order.</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token comment">// Configure Auto Relocation</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>jengelman<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span>ShadowJar

tasks<span class="token punctuation">.</span><span class="token function">named</span><span class="token punctuation">(</span><span class="token string">'shadowJar'</span><span class="token punctuation">,</span> ShadowJar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    enableRelocation <span class="token boolean">true</span>
    relocationPrefix <span class="token string gstring">&quot;myapp&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>Configuring package auto relocation can add significant time to the shadow process as it will process all dependencies
in the configurations declared to be shadowed. By default, this is the <code>runtime</code> or <code>runtimeClasspath</code> configurations.
Be mindful that some Gradle plugins will automatically add dependencies to your class path. You may need to remove these
dependencies if you do not intend to shadow them into your library.  The <code>java-gradle-plugin</code> would normally cause such
problems if it were not for the special handling that Shadow provides as described in
<a href="/shadow/plugins/#special-handling-of-the-java-gradle-plugin-gevelopmeny-plugin">Special Handling of the Java Gradle Plugin Development Plugin</a>.</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/johnrengelman/shadow/edit/master/src/docs/configuration/relocation/README.md" target="_blank" rel="noopener noreferrer">Help improve these docs!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/shadow/configuration/merging/" class="prev">
        Controlling JAR Content Merging
      </a></span> <span class="next"><a href="/shadow/configuration/minimizing/">
        Minimizing
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/shadow/assets/js/app.039bfd27.js" defer></script><script src="/shadow/assets/js/2.09255d06.js" defer></script><script src="/shadow/assets/js/17.36c6b606.js" defer></script>
  </body>
</html>
